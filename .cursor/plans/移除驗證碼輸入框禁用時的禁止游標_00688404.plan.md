---
name: 移除驗證碼輸入框禁用時的禁止游標並加入成功動畫
overview: 1) 修改 input-otp 元件，移除 disabled 狀態下的 cursor-not-allowed 樣式；2) 在驗證成功後顯示 Lottie 成功動畫，動畫完成後再進入修改畫面
todos:
  - id: remove-cursor-not-allowed
    content: 移除 input-otp.jsx 中 disabled:cursor-not-allowed 樣式
    status: completed
  - id: install-lottie-react
    content: 安裝 lottie-react 套件
    status: completed
  - id: add-success-animation-state
    content: 在 AuthDialog 中加入顯示成功動畫的狀態管理
    status: completed
  - id: modify-verification-success-flow
    content: 修改驗證成功流程，先顯示動畫，動畫完成後再呼叫 onSuccess
    status: completed
---

## 修改內容

### 1. 移除禁用時的禁止游標

當輸入完成 4 個數字且正在驗證時（`loading` 為 `true`），輸入框會被禁用，但目前會顯示禁止游標（`cursor-not-allowed`）。需要修改為禁用時不顯示禁止游標。

### 2. 驗證成功後顯示 Lottie 動畫

驗證成功後，先顯示 Lottie 成功動畫（使用本地檔案 `public/animations/success.json`），動畫播放完成後再進入修改畫面。

## 修改檔案

### 1. [`src/components/ui/input-otp.jsx`](src/components/ui/input-otp.jsx)

**第 13 行**：移除 `disabled:cursor-not-allowed` class

**修改前：**

```jsx
className={cn("disabled:cursor-not-allowed justify-center items-center", className)}
```

**修改後：**

```jsx
className={cn("justify-center items-center", className)}
```

### 2. [`package.json`](package.json)

**新增依賴：**

```json
"lottie-react": "^2.4.0"
```

### 3. [`src/components/shareholder/AuthDialog.jsx`](src/components/shareholder/AuthDialog.jsx)

**新增狀態：**

- `showSuccessAnimation`: 控制是否顯示成功動畫（boolean）
- `verificationData`: 儲存驗證成功的資料，用於動畫完成後傳遞給 `onSuccess`
- `animationData`: 儲存從 `public/animations/success.json` 載入的動畫資料

**修改驗證成功處理：**

- 在 `handlePhoneVerification` 和 `handleIdVerification` 中，驗證成功時：

  1. 設定 `showSuccessAnimation = true`
  2. 不立即呼叫 `onSuccess`
  3. 等待動畫播放完成後再呼叫 `onSuccess`

**新增動畫元件：**

- 在 Dialog 中新增成功動畫顯示區域
- 使用 `lottie-react` 載入動畫 JSON
- 使用 `useEffect` 動態載入 `public/animations/success.json` 動畫檔案
- 動畫播放完成後（使用 `onComplete` callback）呼叫 `onSuccess`

**動畫顯示邏輯：**

```jsx
// 載入動畫資料
const [animationData, setAnimationData] = useState(null)

useEffect(() => {
  if (showSuccessAnimation && !animationData) {
    fetch('/animations/success.json')
      .then((res) => res.json())
      .then((data) => setAnimationData(data))
      .catch((err) => {
        console.error('載入動畫失敗:', err)
        // 如果載入失敗，直接呼叫 onSuccess
        if (onSuccess && verificationData) {
          onSuccess(verificationData)
        }
      })
  }
}, [showSuccessAnimation, animationData, onSuccess, verificationData])

// 處理動畫完成後的 callback
const handleAnimationComplete = () => {
  if (onSuccess && verificationData) {
    onSuccess(verificationData)
  }
}

// 在 renderInputFields 中顯示動畫
{showSuccessAnimation && animationData && (
  <Box sx={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', minHeight: '400px' }}>
    <Lottie
      animationData={animationData}
      loop={false}
      autoplay={true}
      onComplete={handleAnimationComplete}
      style={{ width: 200, height: 200 }}
    />
  </Box>
)}
```

### 4. 動畫檔案

**檔案位置：** `public/animations/success.json`

動畫檔案已存在於專案中，程式碼會直接從此路徑載入動畫 JSON。在 `AuthDialog.jsx` 中使用 `fetch('/animations/success.json')` 動態載入動畫資料。

## 說明

### 游標樣式修改

- 目前 `disabled:cursor-not-allowed` 會在輸入框被禁用時顯示禁止游標
- 移除此樣式後，禁用時會使用瀏覽器預設游標（通常是 `cursor: default`）
- 輸入框的禁用功能（`disabled={loading || sendingCode}`）仍然保持，只是游標樣式改變

### 成功動畫流程

1. 驗證成功時，設定 `showSuccessAnimation = true`
2. 隱藏原本的輸入介面，顯示成功動畫
3. 動畫播放完成後（`onComplete`），呼叫 `onSuccess` callback
4. 父元件（`page.jsx`）接收到 `onSuccess` 後，關閉對話框並顯示修改表單

### 動畫檔案

- 動畫檔案位置：`public/animations/success.json`
- 程式碼會直接從本地檔案載入，無需網路連線
- 動畫載入方式：在 `AuthDialog.jsx` 中使用 `useEffect` 和 `fetch('/animations/success.json')` 動態載入